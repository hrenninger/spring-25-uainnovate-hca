@model List<HL7WebInterface.Models.HL7Message>

<h2>HL7 Messages</h2>

<a href="@Url.Action("LoadHL7File", "HL7")" class="btn btn-primary">Load HL7 File</a>

<!-- Change your table structure to this -->
<table id="indexTable" class="table table-striped table-bordered mt-3">
    <thead>
        <tr>
            <th>ID</th>
            <th>Timestamp</th>
            <th>MRN</th>
            <th>Facility</th>
            <th>Account Number</th>
            <th>Last Name</th>
            <th>First Name</th>
            <th>Message Type</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var message in Model)
        {
            <tr data-message-id="@message.Id">
                <td>@message.Id</td>
                <td>@message.DateTime.ToString("yyyy-MM-dd HH:mm")</td>
                <td>
                    <a href="@Url.Action("Details", "HL7", new { mrn = message.MRN, facility = message.Facility })">
                        @message.MRN
                    </a>
                </td>
                <td>@message.Facility</td>
                <td>@message.AccountNumber</td>
                <td>@message.LastName</td>
                <td>@message.FirstName</td>
                <td>@message.MSH9</td>
                <td>
                    <button class="btn btn-info btn-sm toggle-raw" data-message-id="@message.Id">Raw</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Add this section after the table for the raw messages -->
@foreach (var message in Model)
{
    <div id="rawMessage-@message.Id" class="raw-message-container collapse">
        <div class="card mt-1 mb-3">
            <div class="card-body">
                <pre>@message.RawMessage</pre>
            </div>
        </div>
    </div>
}

<!-- Pagination Controls -->
<div class="mt-3">
    @if (ViewBag.CurrentPage > 1)
    {
        <a href="@Url.Action("Index", new { page = ViewBag.CurrentPage - 1 })" class="btn btn-secondary">Previous</a>
    }
    <span> Page @ViewBag.CurrentPage of @ViewBag.TotalPages </span>
    @if (ViewBag.CurrentPage < ViewBag.TotalPages)
    {
        <a href="@Url.Action("Index", new { page = ViewBag.CurrentPage + 1 })" class="btn btn-secondary">Next</a>
    }
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.1/css/dataTables.dataTables.min.css" integrity="sha384-zUxWDVAcow8yNu+q4VFsyZA3qWsKKGdWPW0SVjaR12LQze4SY8Nr75US6VDhbWkf" crossorigin="anonymous">
    <script src="https://cdn.datatables.net/2.0.1/js/dataTables.min.js" integrity="sha384-O1CwIpQyArpIVIf/MmRsfivHkHhSlKgnk+wOxIMeEqObjH8MoV/Ox0ue6FlCwucf" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            // Initialize DataTable
            let table = new DataTable('#indexTable', {
                "columnDefs": [
                    { "targets": [8], "orderable": false } // Disable sorting for Actions
                ]
            });

            // Handle the Raw button click
            $('.toggle-raw').on('click', function () {
                const messageId = $(this).data('message-id');
                $('#rawMessage-' + messageId).toggleClass('show');
            });
        });
    </script>
   
}
